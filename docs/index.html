<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divided by Seas, United by Peaks: Micah's Mountain Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🏔️</text></svg>">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-sky-light text-slate-800 antialiased">
    <header class="sticky top-0 z-50 bg-header/80 backdrop-blur-md shadow-lg">
        <div class="container mx-auto px-4">
            <nav class="flex justify-between items-center py-4">
                <a href="#" id="main-logo" class="text-xl md:text-2xl font-bold text-header-dark">🏔️ Micah's Mountain Quest</a>
                <div class="hidden md:flex items-center space-x-8">
                    <div class="relative flex flex-col items-center">
                        <button data-page="journey" class="nav-tab text-header-dark hover:text-dirt font-medium border-b-2 border-transparent">Journey</button>
                        <button id="list" type="pointer" class="action-button action-link opacity-0 pointer-events-none absolute top-full mt-4 text-white text-lg font-semibold hover:text-glow transition flex flex-col items-center gap-1 cursor-pointer">
                            <span class="text-2xl">🔗</span>
                            <span class="max-w-[150px] leading-tight text-center">See my<br>progression list</span>
                        </button>
                    </div>
                
                    <div class="relative flex flex-col items-center">
                        <button data-page="dossier" class="nav-tab text-header-dark hover:text-dirt font-medium border-b-2 border-transparent">Taiwan's Issues</button>
                        <a id="dossier" type="pointer" class="action-button action-link opacity-0 pointer-events-none absolute top-full mt-4 text-white text-lg font-semibold hover:text-glow transition flex flex-col items-center gap-1 cursor-pointer">
                            <span class="text-2xl">☝️</span>
                            <span class="max-w-[150px] leading-tight text-center">Read the<br>dossier</span>
                        </a>
                    </div>
                
                    <div class="relative flex flex-col items-center">
                        <button data-page="plan" class="nav-tab text-header-dark hover:text-dirt font-medium border-b-2 border-transparent">Plan</button>
                        <a id="plan" type="pointer" class="action-button action-link opacity-0 pointer-events-none absolute top-full mt-4 text-white text-lg font-semibold hover:text-glow transition flex flex-col items-center gap-1 cursor-pointer">
                            <span class="text-2xl">☝️</span>
                            <span class="max-w-[150px] leading-tight text-center">See the<br>interactive plan</span>
                        </a>
                    </div>
                </div>
                <button id="mobile-menu-button" class="md:hidden text-header-dark text-2xl">☰</button>
            </nav>
        </div>
        <div id="mobile-menu" class="opacity-0 pointer-events-none hidden md:hidden absolute top-full right-4 mt-2 w-48 bg-neutral-100/90 backdrop-blur-lg rounded-md shadow-lg py-1">
            <div class="relative flex items-center">
                <button id="list-mobile" type="pointer" 
                        class="action-button action-link opacity-0 pointer-events-none absolute right-full w-max
                               text-white text-base md:text-lg font-semibold hover:text-glow
                               transition flex items-center gap-1 cursor-pointer">
                    <span class="leading-tight text-left py-1 title='Follow this list to overcome heights yourself!'">See my<br>progression list</span>
                    <span class="text-2xl">🔗</span>
                </button>
                <button data-page="journey" class="block w-full text-left py-3 px-4 text-header-dark hover:bg-slate-500/10">Journey</button>
            </div>
            <div class="relative flex items-center">
                <button data-page="dossier" class="block w-full text-left py-3 px-4 text-header-dark hover:bg-slate-500/10">Taiwan's Issues</button>
                <button id="dossier-mobile" type="pointer" 
                        class="action-button action-link opacity-0 pointer-events-none absolute right-full w-max
                               text-white text-base md:text-lg font-semibold hover:text-glow
                               transition flex items-center gap-1 cursor-pointer">
                    <span class="leading-tight text-cente py-1 w-full">Read the dossier</span>
                    <span class="text-2xl">👉</span>
                </button>
            </div>
            <div class="relative flex items-center">
                <button id="plan-mobile" type="pointer"
                        class="action-button action-link opacity-0 pointer-events-none absolute right-full w-max
                               text-white text-base md:text-lg font-semibold hover:text-glow
                               transition flex items-center gap-1 cursor-pointer">
                    <span class="leading-tight text-center py-1 w-full">See the<br>interactive plan</span>
                    <span class="text-xl md:text-2xl">👉</span>
                </button>
                <button data-page="plan" class="block w-full text-left py-3 px-4 text-header-dark hover:bg-slate-500/10">Plan</button>
            </div>
        </div>
    </header>
    
    <div id="page-container">
        <div id="journey-page">
            <section id="hero-section" class="min-h-screen bg-sky-light flex flex-col">
                <div class="flex-grow flex items-center justify-center py-12">
                    <div class="container mx-auto px-4">
                        <div id="hero-text-panel" class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-md prose lg:prose-xl text-left">
                            <h1 class="text-header-dark">The Pull of the Heights</h1>
                            <p>There's a certain quiet magnetism to high places. It's more than just a view; it's a change in perspective. For me, the motivation isn't about conquest or ticking off a list. It's about stepping into an environment that demands presence, resilience, and a deep respect for the natural world. It's about the simplicity of putting one foot in front of the other when everything else falls away.</p>
                            <blockquote>
                                <p>"The mountains are calling and I must go."</p>
                                <cite>- John Muir</cite>
                            </blockquote>
                            <p>This planner is the first step in a long journey. It's the transition from dreaming to doing. By breaking down the process—understanding the skills, finding the right teachers, budgeting for the adventure—the seemingly impossible becomes a series of achievable steps. Each course researched, each piece of gear understood, is a small ascent in itself.</p>
                        </div>
                    </div>
                </div>
            </section>
            <footer id="storyButtonContainer" class="sticky flex flex-row bottom-0 z-10 items-center justify-center">
                <a href="#my-story" id="story-button" class="story-button inline-flex flex-col items-center text-header-dark hover:text-dirt transition">
                    <span class="text-sm font-semibold">See My Story</span>
                    <span class="text-2xl">↓</span>
                </a>
            </footer>
            <section id="my-story" class="slideshow-container">
                <div id="slideshow" class="relative w-full h-full">
                </div>
                <a id="prev-slide" href="#my-story" class="absolute top-1/2 left-4 transform -translate-y-1/2 text-white text-4xl bg-black/30 rounded-full p-2">‹</a>
                <a id="next-slide" href="#my-story" class="absolute top-1/2 right-4 transform -translate-y-1/2 text-white text-4xl bg-black/30 rounded-full p-2">›</a>
            </section>
        </div>

        <div id="dossier-page" class="hidden">
            <section class="hero-layered text-center px-4 relative">
                <div class="container mx-auto relative z-20 flex flex-col justify-center h-full">
                    <h1 class="text-4xl md:text-6xl font-extrabold text-white leading-tight" style="text-shadow: 0px 2px 4px rgba(45, 58, 58, 0.5);">Hiking in Taiwan: The Path Forward</h1>
                    <p class="text-lg md:text-xl text-navy-dark/80 max-w-3xl mx-auto mt-4">Exploring the challenges and opportunities for creating a world-class hiking destination.</p>
                </div>
            </section>
            <section class="py-16 md:py-24 bg-light-blue">
                 <div class="container mx-auto px-4">
                    <div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-md prose lg:prose-xl text-left">
                        <h2 class="text-header-dark">Observations from the Trail</h2>
                        <p>This section is a placeholder for detailed analysis of the issues observed within Taiwan's hiking culture, both from personal experience and from discussions with international hikers. Topics may include trail maintenance standards, inconsistent signage, lack of accessible information in English, and cultural differences in trail etiquette.</p>
                    </div>
                 </div>
            </section>
        </div>


        <div id="plan-page" class="hidden">
            <main>
                <section id="home-plan" class="hero-layered text-center px-4 relative">
                    <div class="container mx-auto relative z-20 flex flex-col justify-center h-full">
                        <h1 class="text-4xl md:text-6xl font-extrabold text-white leading-tight" style="text-shadow: 0px 2px 4px rgba(45, 58, 58, 0.5);">The Plan</h1>
                        <p class="text-lg md:text-xl text-navy-dark/80 max-w-3xl mx-auto mt-4">An interactive dashboard to explore courses, compare options, and build a budget.</p>
                    </div>
                </section>

                <section id="foundations" class="py-16 md:py-24 bg-sky-light">
                    <div class="container mx-auto px-4">
                        <div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-header-dark">Foundational Knowledge</h2><p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">A breakdown of the core skills, essential gear, and fitness required to begin the journey safely and confidently.</p></div>
                        <div class="max-w-4xl mx-auto bg-white p-6 md:p-8 rounded-lg shadow-md"><div class="flex border-b border-gray-300 mb-6"><button data-tab="skills" class="tab flex-1 py-3 px-2 font-semibold text-slate-600 border-b-2 border-transparent hover:border-dirt hover:text-dirt transition active">Core Skills</button><button data-tab="gear" class="tab flex-1 py-3 px-2 font-semibold text-slate-600 border-b-2 border-transparent hover:border-dirt hover:text-dirt transition">Essential Gear</button><button data-tab="fitness" class="tab flex-1 py-3 px-2 font-semibold text-slate-600 border-b-2 border-transparent hover:border-dirt hover:text-dirt transition">Fitness</button></div>
                            <div id="tab-content">
                                <div id="skills-content" class="tab-pane"><h3 class="text-2xl font-bold text-header-dark mb-4">The Craft of Alpinism</h3><p class="text-slate-600 mb-6">Introductory courses build a foundation in rock, snow, and ice travel.</p><div class="space-y-4"><div class="p-4 border border-slate-200 rounded-lg"><h4 class="font-bold text-lg text-header-dark">🧗 Rock Craft</h4><p class="text-slate-600 mt-1">Knots, belaying, rappelling, and efficient movement on rock.</p></div><div class="p-4 border border-slate-200 rounded-lg"><h4 class="font-bold text-lg text-header-dark">❄️ Snow & Glacier Travel</h4><p class="text-slate-600 mt-1">Ice axe and crampon use for secure movement on snow and ice, including self-arrest.</p></div><div class="p-4 border border-slate-200 rounded-lg"><h4 class="font-bold text-lg text-header-dark">🧠 Mountain Sense</h4><p class="text-slate-600 mt-1">Navigation, weather interpretation, hazard assessment, and trip planning.</p></div></div></div>
                                <div id="gear-content" class="hidden tab-pane"><h3 class="text-2xl font-bold text-header-dark mb-4">Gear: Rent vs. Buy Strategy</h3><p class="text-slate-600 mb-6">A smart approach to gear saves money without compromising safety. Rent technical hardware first.</p><div class="grid md:grid-cols-2 gap-6 mt-4"><div class="bg-header-dark/10 p-6 rounded-lg"><h4 class="font-bold text-xl text-center text-header-dark mb-4">✅ Rent These First</h4><ul class="space-y-2 text-slate-700 list-disc list-inside"><li>Ice Axe</li><li>Crampons</li><li>Helmet</li><li>Harness</li></ul></div><div class="bg-dirt/10 p-6 rounded-lg"><h4 class="font-bold text-xl text-center text-dirt mb-4">💰 Consider Buying</h4><ul class="space-y-2 text-slate-700 list-disc list-inside"><li>Mountaineering Boots (Fit is key!)</li><li>Waterproof Shells</li><li>35-45L Backpack</li><li>Layering System</li></ul></div></div></div>
                                <div id="fitness-content" class="hidden tab-pane"><h3 class="text-2xl font-bold text-header-dark mb-4">Fitness Imperative</h3><p class="text-slate-600 mb-6">Physical fitness is the biggest factor in enjoyment and success. "Mountain fit" is about sustained, multi-hour endurance.</p><div class="mt-4 space-y-4"><div><h4 class="font-bold text-lg text-header-dark">Training Goal</h4><p class="text-slate-600">Hike uphill for several hours with a 10-15 kg (22-33 lbs) pack, day after day.</p></div><div><h4 class="font-bold text-lg text-header-dark">Best Training</h4><p class="text-slate-600"><span class="font-semibold">Cardio:</span> Hike uphill with a weighted pack. <br><span class="font-semibold">Strength:</span> Legs and core (squats, lunges, step-ups).</p></div><div><h4 class="font-bold text-lg text-header-dark">Benchmark</h4><p class="text-slate-600">The ability to ascend 400-500 vertical meters per hour is a strong target for any beginner course.</p></div></div></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="courses" class="py-16 md:py-24 bg-sky-mid">
                    <div class="container mx-auto px-4"><div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-header-dark">Course Finder & Comparison Tool</h2><p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">Filter courses to find options matching location, style, and budget. Click for details and add courses to the comparison tool.</p></div>
                        <div class="bg-white/70 p-4 rounded-lg shadow-sm mb-8 grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div><label for="filter-region" class="block text-sm font-medium text-slate-700">Region</label><select id="filter-region" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-dirt focus:border-dirt rounded-md"><option value="all">All Regions</option><option value="europe">Europe</option><option value="usa">USA</option><option value="japan">Japan</option></select></div>
                            <div><label for="filter-style" class="block text-sm font-medium text-slate-700">Style / Focus</label><select id="filter-style" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-dirt focus:border-dirt rounded-md"><option value="all">All Styles</option><option value="all-round">All-Round</option><option value="summit-goal">Summit Goal</option><option value="rock-focus">Rock Focus</option><option value="glacier-skills">Glacier Skills</option><option value="budget-club">Budget / Club</option></select></div>
                            <div><label for="filter-duration" class="block text-sm font-medium text-slate-700">Duration (Days)</label><select id="filter-duration" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-dirt focus:border-dirt rounded-md"><option value="all">All Durations</option><option value="1-3">1-3 Days</option><option value="4-6">4-6 Days</option><option value="7+">7+ Days</option></select></div>
                            <div><label for="filter-price" class="block text-sm font-medium text-slate-700">Max Price (EUR)</label><select id="filter-price" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-dirt focus:border-dirt rounded-md"><option value="all">Any Price</option><option value="750">Under €750</option><option value="1500">Under €1500</option><option value="2000">Under €2000</option></select></div>
                        </div>
                        <div id="course-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
                        <div id="no-results" class="hidden text-center py-12"><p class="text-xl text-slate-500">No courses match criteria. Adjust filters.</p></div>
                    </div>
                </section>

                <section id="online" class="py-16 md:py-24 bg-sky-light">
                    <div class="container mx-auto px-4"><div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-header-dark">Digital Basecamp: Online Prep</h2><p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">Online courses are a powerful "pre-course accelerator" to learn theory at home, maximizing valuable time with a guide. They are a supplement, not a substitute.</p></div>
                        <div class="grid md:grid-cols-3 gap-8 max-w-6xl mx-auto">
                            <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-dirt"><h3 class="text-xl font-bold text-header-dark">Kaf Adventures</h3><p class="font-semibold text-slate-700 mt-1">$199</p><p class="text-slate-600 mt-2">Comprehensive, self-paced online course covering gear, planning, and glacier travel theory. Includes homework and certification.</p><p class="mt-4 font-semibold text-slate-700">Best for: A pre-course primer for a glacier-focused trip.</p></div>
                            <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-dirt"><h3 class="text-xl font-bold text-header-dark">MTN Sense</h3><p class="font-semibold text-slate-700 mt-1">~$299</p><p class="text-slate-600 mt-2">A huge library of 120+ video lessons from an IFMGA guide with forever access. Covers an exhaustive range of topics.</p><p class="mt-4 font-semibold text-slate-700">Best for: A long-term educational resource.</p></div>
                            <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-dirt"><h3 class="text-xl font-bold text-header-dark">The Mountaineers</h3><p class="font-semibold text-slate-700 mt-1">Free / Varies</p><p class="text-slate-600 mt-2">A non-profit club offering free articles and short online courses on specific skills like high-altitude travel and conservation.</p><p class="mt-4 font-semibold text-slate-700">Best for: Free supplementary learning.</p></div>
                        </div>
                    </div>
                </section>

                <section id="budget" class="py-16 md:py-24 bg-sky-mid">
                    <div class="container mx-auto px-4"><div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-header-dark">Trip Budgeting</h2><p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">A visual cost comparison and an interactive planner to turn the dream into an itinerary.</p></div>
                        <div class="grid lg:grid-cols-5 gap-8 items-start">
                            <div class="lg:col-span-3 bg-white/70 p-6 rounded-lg shadow-md"><h3 class="text-2xl font-bold text-header-dark mb-4">Sample Trip Cost Comparison</h3><p class="text-slate-600 mb-6">Estimated total costs for popular beginner pathways, excluding major airfare. Highlights that non-course expenses are significant.</p><div class="chart-container"><canvas id="costChart"></canvas></div></div>
                            <div class="lg:col-span-2 bg-header-dark/10 p-6 rounded-lg shadow-md"><h3 class="text-2xl font-bold text-header-dark mb-4">Interactive Budget Planner</h3><p class="text-slate-600 mb-6">Select a pathway to see a sample budget, then adjust the values for a custom estimate.</p><div><label for="budget-pathway" class="block text-sm font-medium text-slate-700">Select Pathway</label><select id="budget-pathway" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-dirt focus:border-dirt rounded-md"><option value="chamonix">European Classic (Chamonix, 5 Days)</option><option value="pnw">US Glacier School (PNW, 6 Days)</option><option value="colorado">Budget Club (Colorado, Season)</option></select></div><div class="mt-4 space-y-2"><div class="flex justify-between items-center"><label for="cost-course" class="text-slate-700">Course Fee (€)</label><input type="number" id="cost-course" class="w-28 text-right p-1 rounded border-gray-300"></div><div class="flex justify-between items-center"><label for="cost-accom" class="text-slate-700">Accommodation (€)</label><input type="number" id="cost-accom" class="w-28 text-right p-1 rounded border-gray-300"></div><div class="flex justify-between items-center"><label for="cost-food" class="text-slate-700">Food/Incidentals (€)</label><input type="number" id="cost-food" class="w-28 text-right p-1 rounded border-gray-300"></div><div class="flex justify-between items-center"><label for="cost-gear" class="text-slate-700">Gear/Lifts (€)</label><input type="number" id="cost-gear" class="w-28 text-right p-1 rounded border-gray-300"></div></div><div class="mt-4 pt-4 border-t border-header-dark/20"><div class="flex justify-between items-center text-xl font-bold"><span class="text-header-dark">Estimated Total:</span><span id="total-cost" class="text-dirt">€2300</span></div></div></div>
                        </div>
                    </div>
                </section>

                <section id="finish" style="height: 100px;"></section>
            </main>
            <div id="progress-bar-container-wrapper" class="">
                <div class="gpx-progress-container h-16 shadow-inner">
                    <div class="relative w-full h-full container mx-auto px-4">
                        <div class="gpx-elements">
                            <svg id="gpx-path-svg" class="absolute top-0 left-0 w-full h-full" preserveAspectRatio="none" viewBox="0 0 1200 60">
                                <path id="gpx-path-base" d="M 50 50 l 15-2 l 10 3 l 15-7 l 10 7 l 15-3 l 10 2 l 15 0 L 250 20 L 265 30 l 15-5 l 10 8 l 15-8 l 10 3 l 15-5 l 20 8 l 15-3 L 450 25 L 465 35 l 15-8 l 10 5 l 15-10 l 10 8 l 15-3 L 600 15 L 615 25 l 15-5 l 10 8 l 15-3 l 10-5 l 15 8 l 15 0 L 800 10 L 815 20 l 15-5 l 10 8 l 15-3 l 10 5 l 15-8 l 10-2 l 15 8 L 1000 20 L 1015 30 l 15-8 l 10 5 l 15-3 l 10 8 l 15-5 l 60-5" stroke="#7f8c8d" stroke-width="2" fill="none" stroke-dasharray="4 4"/>
                                <path id="gpx-path-progress" d="M 50 50 l 15-2 l 10 3 l 15-7 l 10 7 l 15-3 l 10 2 l 15 0 L 250 20 L 265 30 l 15-5 l 10 8 l 15-8 l 10 3 l 15-5 l 20 8 l 15-3 L 450 25 L 465 35 l 15-8 l 10 5 l 15-10 l 10 8 l 15-3 L 600 15 L 615 25 l 15-5 l 10 8 l 15-3 l 10-5 l 15 8 l 15 0 L 800 10 L 815 20 l 15-5 l 10 8 l 15-3 l 10 5 l 15-8 l 10-2 l 15 8 L 1000 20 L 1015 30 l 15-8 l 10 5 l 15-3 l 10 8 l 15-5 l 60-5" stroke="#A0522D" stroke-width="4" fill="none"/>
                            </svg>
                            <div id="gpx-labels" class="absolute w-full h-full top-0 left-0">
                                 </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="details-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 z-100 flex items-center justify-center p-4 hidden"></div>
    <div id="compare-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 z-100 flex items-start justify-center p-4 hidden"></div>
    <div id="toast-notification" class="toast-notification fixed top-5 right-5 bg-terracotta text-white py-2 px-5 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 z-50"></div>
    <div id="compare-tray" class="compare-tray fixed bottom-0 left-0 right-0 bg-wood-panel text-header-dark p-4 shadow-2xl"><div class="container mx-auto flex justify-between items-center"><div><h4 class="font-bold text-lg">Compare Courses</h4><div id="compare-items" class="flex items-center space-x-2 mt-1"></div></div><div class="flex items-center space-x-4"><button id="compare-now-btn" class="accent-dirt text-white font-bold py-2 px-6 rounded-md hover:bg-opacity-90 transition disabled:opacity-50 disabled:cursor-not-allowed">Compare</button><button id="clear-compare-btn" class="text-sm text-slate-600 hover:text-header-dark">Clear</button></div></div></div>

<script type="module">
        // 1. IMPORT your new modules at the top.
        import slidesData from './js/slideshow-data.js';
        import { initSlideshow } from './js/slideshow.js';
        import { GPXProgressTracker } from './js/gpx-tracker.js';
        import { initCourseFinder } from './js/course-finder.js'; // <-- ADD THIS
        import './js/menu.js';

        // 2. All of your original JavaScript code now lives inside this single DOMContentLoaded listener.
        document.addEventListener('DOMContentLoaded', () => {
            const gpxTracker = new GPXProgressTracker();
            gpxTracker.init();
            
            // REMOVED the big 'courses' array and all related functions.

            const tabs = document.querySelectorAll('.tab');
            const tabPanes = document.querySelectorAll('.tab-pane');
            tabs.forEach(tab => tab.addEventListener('click', () => { tabs.forEach(t => t.classList.remove('active')); tab.classList.add('active'); tabPanes.forEach(p => p.classList.toggle('hidden', p.id !== `${tab.dataset.tab}-content`)); }));

            const costChart = new Chart(document.getElementById('costChart').getContext('2d'), { type: 'bar', data: { labels: ['European Classic (Chamonix)', 'US Glacier School (PNW)', 'Budget Club (Colorado)'], datasets: [{ label: 'Estimated Trip Cost (€)', data: [2300, 2400, 930], backgroundColor: ['#2F4F4F', '#A0522D', '#7f8c8d'] }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: c => `Est. Total: ${new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(c.parsed.y)}` } } }, scales: { y: { beginAtZero: true, ticks: { callback: v => '€' + v.toLocaleString() } } } } });

            const budgetPathway = document.getElementById('budget-pathway');
            const budgetInputs = { course: document.getElementById('cost-course'), accom: document.getElementById('cost-accom'), food: document.getElementById('cost-food'), gear: document.getElementById('cost-gear') };
            const budgetData = { chamonix: { course: 1145, accom: 600, food: 300, gear: 250 }, pnw: { course: 1700, accom: 280, food: 230, gear: 185 }, colorado: { course: 560, accom: 0, food: 185, gear: 185 } };
            const totalCostEl = document.getElementById('total-cost');
            function calculateTotal() { const total = Object.values(budgetInputs).reduce((s, i) => s + (Number(i.value) || 0), 0); totalCostEl.textContent = '€' + total.toLocaleString(); }
            function updateCalculator() { Object.assign(budgetInputs, Object.fromEntries(Object.entries(budgetData[budgetPathway.value]).map(([k,v]) => [k, (budgetInputs[k].value=v, budgetInputs[k])]))); calculateTotal(); }
            budgetPathway.addEventListener('change', updateCalculator);
            Object.values(budgetInputs).forEach(input => input.addEventListener('input', calculateTotal));

            const header = document.querySelector('header');
            header.addEventListener('click', (e) => {
                const actionButton = e.target.closest('.action-button');
                if (!actionButton) return;
                switch (actionButton.id) {
                    case 'list':
                        window.location.href = './list/';
                        break;
                    case 'dossier':
                        switchPage('dossier');
                        break;
                    case 'plan':
                        switchPage('plan');
                        break;
                }
            });

            function setHeroSectionDynamicHeight() {
                const header = document.querySelector('header');
                const storyButtonContainer = document.getElementById('storyButtonContainer');
                const heroSection = document.getElementById('hero-section');
    
                if (header && storyButtonContainer && heroSection) {
                    const headerHeight = header.offsetHeight;
                    const footerHeight = storyButtonContainer.offsetHeight;
                    const dynamicMinHeight = window.innerHeight - headerHeight - footerHeight;
                    heroSection.style.minHeight = `${dynamicMinHeight}px`;
                }
            }
    
            setHeroSectionDynamicHeight();
            window.addEventListener('resize', setHeroSectionDynamicHeight);
            
            const initialOpacity = 0.15;
            const finalOpacity = 1;
            const fadeZoneHeight = 200;
            const exponentialPower = 3;
            
            function updateStoryButtonOpacity() {
                const heroTextPanel = document.getElementById('hero-text-panel');
                const storyButtonContainer = document.getElementById('storyButtonContainer');
                const storyButton = document.getElementById('story-button');
                if (!storyButton || !heroTextPanel || !storyButtonContainer || document.getElementById('journey-page').classList.contains('hidden')) {
                    if (storyButton) {
                        storyButton.style.opacity = '';
                    }
                    return;
                }
                const heroTextPanelRect = heroTextPanel.getBoundingClientRect();
                const storyButtonContainerRect = storyButtonContainer.getBoundingClientRect();
                const overlap = heroTextPanelRect.bottom - storyButtonContainerRect.top;
                let opacity;
                if (overlap <= 0) {
                    opacity = finalOpacity;
                } else if (overlap >= fadeZoneHeight) {
                    opacity = initialOpacity;
                } else {
                    const normalizedOverlap = overlap / fadeZoneHeight;
                    opacity = initialOpacity + (finalOpacity - initialOpacity) * Math.pow(1 - normalizedOverlap, exponentialPower);
                }
                storyButton.style.opacity = opacity.toFixed(2);
            }
            
            window.addEventListener('scroll', updateStoryButtonOpacity);
            updateStoryButtonOpacity();
            
            const navTabs = document.querySelectorAll('.nav-tab, #mobile-menu button, #main-logo');
            const pages = [
                document.getElementById('journey-page'),
                document.getElementById('dossier-page'),
                document.getElementById('plan-page')
            ]

            function switchPage(requestedPage) {
                pages.forEach(page => {
                    page.classList.toggle('hidden', page.id !== `${requestedPage}-page`);
                });
                document.body.className = document.body.className.split(' ').filter(c => !c.endsWith('-active')).join(' ');
                document.body.classList.add(`${requestedPage}-active`);

                const isJourneyPage = requestedPage === 'journey';
                if (!isJourneyPage) {
                    document.querySelectorAll('.action-button').forEach(btn => {
                        btn.classList.add('opacity-0', 'pointer-events-none');
                        setTimeout(() => {
                            btn.classList.add('hidden');
                        }, 300);
                    });
                }
                if (requestedPage === 'journey' && window.slideshow) {
                    window.slideshow.updateUI();
                }
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.page === requestedPage);
                });
                document.querySelectorAll('#mobile-menu button').forEach(button => {
                    button.classList.toggle('mobile-tab-active', button.dataset.page === requestedPage);
                });
                window.scrollTo(0,0);
            }
            
            navTabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchPage(tab.dataset.page || 'journey');
                });
            });

            // 3. INITIALIZE your new modules here.
            initSlideshow(slidesData, switchPage);
            initCourseFinder(); // <-- ADD THIS
            
            // Initial Page Setup
            switchPage('journey');
            updateCalculator();
        });
    </script>
</body>
</html>
